import{o as oe,r as l,j as e,C as be,z as Se,A as Pe,O as Ee,y as ke,D as S,F as _e,T as ze,H as Oe,J as B,M as Fe,U as Le,K as H,G as m,x as h,B as d,L as p,E as N,Q as Te}from"./dashboard-tabs.js";const v=oe("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const Ue=oe("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);function g(){const n=window.PuzzlingLoginConfig;if(!n?.ajaxUrl||!n.nonce)throw new Error("PuzzlingLoginConfig not found");return n}function y(n){const o=new FormData;return o.append("security",g().nonce),Object.entries(n).forEach(([t,a])=>{a!==void 0&&a!==""&&o.append(t,String(a))}),o}async function De(n){const{ajaxUrl:o}=g(),a=await(await fetch(o,{method:"POST",body:y({action:"puzzling_send_login_otp",phone_number:n})})).json();if(!a.success)throw new Error(a.data?.message||"خطا در ارسال کد");return a.data}async function Me(n,o){const{ajaxUrl:t}=g(),r=await(await fetch(t,{method:"POST",body:y({action:"puzzling_verify_login_otp",phone_number:n,otp_code:o})})).json();if(!r.success)throw new Error(r.data?.message||"کد تایید اشتباه است");return r.data}async function Ae(n){const{ajaxUrl:o}=g(),a=await(await fetch(o,{method:"POST",body:y({action:"puzzling_send_email_otp",email:n})})).json();if(!a.success)throw new Error(a.data?.message||"خطا در ارسال کد");return a.data}async function $e(n,o){const{ajaxUrl:t}=g(),r=await(await fetch(t,{method:"POST",body:y({action:"puzzling_verify_email_otp",email:n,otp_code:o})})).json();if(!r.success)throw new Error(r.data?.message||"کد تایید اشتباه است");return r.data}async function V(n,o,t){const{ajaxUrl:a}=g(),i=await(await fetch(a,{method:"POST",body:y({action:"puzzling_login_with_password",username:n,password:o,remember:t?1:0})})).json();if(!i.success)throw new Error(i.data?.message||"ورود ناموفق");return i.data}async function Ie(n,o,t){const{ajaxUrl:a}=g(),i=await(await fetch(a,{method:"POST",body:y({action:"puzzling_set_password",phone_number:n,password:o,confirm_password:t})})).json();if(!i.success)throw new Error(i.data?.message||"خطا در تنظیم رمز");return i.data}function Re(){return window.PuzzlingLoginConfig}const Be=/^(09|۰۹)[0-9۰-۹]{9}$/;function G(n){return n.replace(/[۰-۹]/g,o=>String("۰۱۲۳۴۵۶۷۸۹".indexOf(o)))}function le(n,o,t){const[a,r]=l.useState(n);l.useEffect(()=>{if(!o||a<=0)return;const x=setInterval(()=>{r(f=>f<=1?(t?.(),0):f-1)},1e3);return()=>clearInterval(x)},[o,a,t]);const i=l.useCallback(x=>r(x),[]);return{seconds:a,start:i,formatted:`${Math.floor(a/60)}:${String(a%60).padStart(2,"0")}`}}function He(){const n=Re(),[o,t]=l.useState(null),[a,r]=l.useState(!1),[i,x]=l.useState(""),[f,E]=l.useState("input"),[J,K]=l.useState(""),[k,_]=l.useState(!1),Q=le(300,k&&f==="otp",()=>_(!1)),[W,q]=l.useState(!1),[z,ie]=l.useState(""),[w,O]=l.useState(!1),[X,de]=l.useState(!1),[C,me]=l.useState(""),[F,he]=l.useState(""),[L,ue]=l.useState(!1),[T,pe]=l.useState(!1),[j,U]=l.useState(""),[b,Y]=l.useState("input"),[Z,ee]=l.useState(""),[D,M]=l.useState(!1),[se,te]=l.useState(!1),[A,xe]=l.useState(""),ae=le(300,D&&b==="otp",()=>M(!1)),[$,fe]=l.useState(""),[I,ge]=l.useState(""),[u,R]=l.useState(!1),ne=async()=>{const s=G(i).replace(/\D/g,"");if(!Be.test(s)&&!/^09[0-9]{9}$/.test(s)){t({type:"error",text:"فرمت شماره موبایل صحیح نیست (مثال: 09123456789)"});return}r(!0),t(null);try{await De(s),x(s),E("otp"),_(!0),Q.start(300),t({type:"success",text:"کد تایید به شماره شما ارسال شد."})}catch(c){t({type:"error",text:c instanceof Error?c.message:"خطا در ارسال کد"})}finally{r(!1)}},we=async()=>{const s=G(J).replace(/\D/g,"");if(s.length<4){t({type:"error",text:"کد تایید را وارد کنید."});return}r(!0),t(null);try{const c=await Me(i,s);c.needs_password?(de(!0),E("password")):c.redirect_url&&(window.location.href=c.redirect_url)}catch(c){t({type:"error",text:c instanceof Error?c.message:"کد تایید اشتباه است"})}finally{r(!1)}},je=async()=>{if(C.length<6){t({type:"error",text:"رمز عبور باید حداقل 6 کاراکتر باشد."});return}if(C!==F){t({type:"error",text:"رمز عبور و تکرار آن یکسان نیست."});return}r(!0),t(null);try{const s=await Ie(i,C,F);s.redirect_url&&(window.location.href=s.redirect_url)}catch(s){t({type:"error",text:s instanceof Error?s.message:"خطا در تنظیم رمز"})}finally{r(!1)}},ye=async()=>{if(!z){t({type:"error",text:"رمز عبور را وارد کنید."});return}r(!0),t(null);try{const s=await V(i,z,w);s.redirect_url&&(window.location.href=s.redirect_url)}catch(s){t({type:"error",text:s instanceof Error?s.message:"ورود ناموفق"})}finally{r(!1)}},re=async()=>{const s=j.trim();if(!s||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)){t({type:"error",text:"یک ایمیل معتبر وارد کنید."});return}r(!0),t(null);try{await Ae(s),U(s),Y("otp"),M(!0),ae.start(300),t({type:"success",text:"کد تایید به ایمیل شما ارسال شد."})}catch(c){t({type:"error",text:c instanceof Error?c.message:"خطا در ارسال کد"})}finally{r(!1)}},Ne=async()=>{const s=G(Z).replace(/\D/g,"");if(s.length<4){t({type:"error",text:"کد تایید را وارد کنید."});return}r(!0),t(null);try{const c=await $e(j,s);c.redirect_url&&(window.location.href=c.redirect_url)}catch(c){t({type:"error",text:c instanceof Error?c.message:"کد تایید اشتباه است"})}finally{r(!1)}},ve=async()=>{if(!A){t({type:"error",text:"رمز عبور را وارد کنید."});return}r(!0),t(null);try{const s=await V(j,A,w);s.redirect_url&&(window.location.href=s.redirect_url)}catch(s){t({type:"error",text:s instanceof Error?s.message:"ورود ناموفق"})}finally{r(!1)}},Ce=async()=>{if(!$.trim()||!I){t({type:"error",text:"نام کاربری و رمز عبور را وارد کنید."});return}r(!0),t(null);try{const s=await V($.trim(),I,w);s.redirect_url&&(window.location.href=s.redirect_url)}catch(s){t({type:"error",text:s instanceof Error?s.message:"ورود ناموفق"})}finally{r(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted/30 p-4",dir:n?.dir||"rtl",children:e.jsxs(be,{className:"w-full max-w-md shadow-lg",children:[e.jsxs(Se,{className:"text-center space-y-1",children:[n?.logoUrl&&e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx("img",{src:n.logoUrl,alt:"",className:"h-12 object-contain"})}),e.jsx(Pe,{className:"text-xl",children:n?.siteName||"ورود"}),e.jsx(Ee,{children:"ورود یا ثبت‌نام به پنل مدیریت"})]}),e.jsxs(ke,{className:"space-y-4",children:[o&&e.jsx(S,{variant:o.type==="error"?"destructive":"success",className:"py-2",children:e.jsx(_e,{children:o.text})}),e.jsxs(ze,{defaultValue:"phone",className:"w-full",children:[e.jsxs(Oe,{className:"grid w-full grid-cols-3",children:[e.jsxs(B,{value:"phone",className:"gap-1",children:[e.jsx(Ue,{className:"h-4 w-4"}),"موبایل"]}),e.jsxs(B,{value:"email",className:"gap-1",children:[e.jsx(Fe,{className:"h-4 w-4"}),"ایمیل"]}),e.jsxs(B,{value:"username",className:"gap-1",children:[e.jsx(Le,{className:"h-4 w-4"}),"نام کاربری"]})]}),e.jsxs(H,{value:"phone",className:"space-y-4 mt-4",children:[f==="input"&&!W&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"phone",children:"شماره موبایل"}),e.jsx(h,{id:"phone",type:"tel",placeholder:"09123456789",value:i,onChange:s=>x(s.target.value.replace(/\D/g,"").slice(0,11)),className:"font-mono"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(d,{onClick:ne,disabled:a,className:"w-full",children:[a?e.jsx(p,{className:"h-4 w-4 animate-spin"}):null,"دریافت کد پیامک"]}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>q(!0),children:"ورود با رمز عبور"})]})]}),f==="input"&&W&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"phone-pw",children:"شماره موبایل"}),e.jsx(h,{id:"phone-pw",type:"tel",placeholder:"09123456789",value:i,onChange:s=>x(s.target.value.replace(/\D/g,"").slice(0,11)),className:"font-mono"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"phone-password",children:"رمز عبور"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"phone-password",type:u?"text":"password",placeholder:"رمز عبور",value:z,onChange:s=>ie(s.target.value),className:"pr-9"}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground",onClick:()=>R(!u),children:u?e.jsx(v,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:s=>O(s.target.checked)}),"مرا به خاطر بسپار"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:ye,disabled:a,className:"flex-1",children:[a?e.jsx(p,{className:"h-4 w-4 animate-spin"}):null,"ورود"]}),e.jsx(d,{variant:"outline",onClick:()=>q(!1),children:"بازگشت"})]})]}),f==="otp"&&!X&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{variant:"default",className:"text-sm",children:["کد به شماره ",i," ارسال شد."]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"otp",children:"کد تایید"}),e.jsx(h,{id:"otp",type:"text",inputMode:"numeric",placeholder:"------",maxLength:8,value:J,onChange:s=>K(s.target.value.replace(/\D/g,"")),className:"text-center text-lg font-mono tracking-widest"}),k&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["زمان باقیمانده: ",Q.formatted]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(d,{onClick:we,disabled:a,className:"w-full",children:[a?e.jsx(p,{className:"h-4 w-4 animate-spin"}):null,"تایید و ورود"]}),e.jsx(d,{variant:"outline",size:"sm",disabled:!k||a,onClick:ne,children:"ارسال مجدد کد"}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>{E("input"),K(""),_(!1)},children:"تغییر شماره موبایل"})]})]}),X&&e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"success",className:"text-sm",children:"لطفاً رمز عبور خود را تنظیم کنید."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"new-password",children:"رمز عبور جدید"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"new-password",type:L?"text":"password",value:C,onChange:s=>me(s.target.value),className:"pr-9"}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground",onClick:()=>ue(!L),children:L?e.jsx(v,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"confirm-password",children:"تکرار رمز عبور"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"confirm-password",type:T?"text":"password",value:F,onChange:s=>he(s.target.value),className:"pr-9"}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground",onClick:()=>pe(!T),children:T?e.jsx(v,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})]}),e.jsxs(d,{onClick:je,disabled:a,className:"w-full",children:[a?e.jsx(p,{className:"h-4 w-4 animate-spin"}):null,"تنظیم رمز و ورود"]})]})]}),e.jsxs(H,{value:"email",className:"space-y-4 mt-4",children:[b==="input"&&!se&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email",children:"ایمیل"}),e.jsx(h,{id:"email",type:"email",placeholder:"example@domain.com",value:j,onChange:s=>U(s.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(d,{onClick:re,disabled:a,className:"w-full",children:[a?e.jsx(p,{className:"h-4 w-4 animate-spin"}):null,"ارسال کد به ایمیل"]}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>te(!0),children:"ورود با رمز عبور"})]})]}),b==="input"&&se&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email-pw",children:"ایمیل"}),e.jsx(h,{id:"email-pw",type:"email",value:j,onChange:s=>U(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email-password",children:"رمز عبور"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"email-password",type:u?"text":"password",value:A,onChange:s=>xe(s.target.value),className:"pr-9"}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground",onClick:()=>R(!u),children:u?e.jsx(v,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:s=>O(s.target.checked)}),"مرا به خاطر بسپار"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:ve,disabled:a,className:"flex-1",children:[a?e.jsx(p,{className:"h-4 w-4 animate-spin"}):null,"ورود"]}),e.jsx(d,{variant:"outline",onClick:()=>te(!1),children:"بازگشت"})]})]}),b==="otp"&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{variant:"default",className:"text-sm",children:["کد به ",j," ارسال شد."]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email-otp",children:"کد تایید"}),e.jsx(h,{id:"email-otp",type:"text",inputMode:"numeric",placeholder:"------",maxLength:8,value:Z,onChange:s=>ee(s.target.value.replace(/\D/g,"")),className:"text-center text-lg font-mono tracking-widest"}),D&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["زمان باقیمانده: ",ae.formatted]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(d,{onClick:Ne,disabled:a,className:"w-full",children:[a?e.jsx(p,{className:"h-4 w-4 animate-spin"}):null,"تایید و ورود"]}),e.jsx(d,{variant:"outline",size:"sm",disabled:!D||a,onClick:re,children:"ارسال مجدد کد"}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>{Y("input"),ee(""),M(!1)},children:"تغییر ایمیل"})]})]})]}),e.jsxs(H,{value:"username",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"username",children:"نام کاربری"}),e.jsx(h,{id:"username",type:"text",placeholder:"نام کاربری",value:$,onChange:s=>fe(s.target.value),autoComplete:"username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"user-password",children:"رمز عبور"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"user-password",type:u?"text":"password",placeholder:"رمز عبور",value:I,onChange:s=>ge(s.target.value),autoComplete:"current-password",className:"pr-9"}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground",onClick:()=>R(!u),children:u?e.jsx(v,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:s=>O(s.target.checked)}),"مرا به خاطر بسپار"]}),e.jsxs(d,{onClick:Ce,disabled:a,className:"w-full",children:[a?e.jsx(p,{className:"h-4 w-4 animate-spin"}):null,"ورود"]}),n?.lostPasswordUrl&&e.jsx("a",{href:n.lostPasswordUrl,className:"text-sm text-primary hover:underline block text-center",children:"فراموشی رمز عبور"})]})]}),n?.registerUrl&&e.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["حساب کاربری ندارید؟"," ",e.jsx("a",{href:n.registerUrl,className:"text-primary hover:underline",children:"ثبت‌نام کنید"})]})]})]})})}const ce=document.getElementById("pzl-login-root");if(!ce)throw new Error("Root element #pzl-login-root not found");const P=window.PuzzlingLoginConfig;P?.dir&&document.documentElement.setAttribute("dir",P.dir);P?.lang&&document.documentElement.setAttribute("lang",P.lang);Te.createRoot(ce).render(e.jsx(l.StrictMode,{children:e.jsx(He,{})}));
